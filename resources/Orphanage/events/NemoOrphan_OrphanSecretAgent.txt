# This text file is a mod script file which uses by the Crusader Kings 2
# Namespace              : OPG
# Reserved Event ID      : 7000~7099
# Suitable CK2 Version   : 2.5.x
# Recently Modified Date : 2016-04-17

namespace = OPG

#==============================================================================#
# 비밀 고아 요원                                                               #
# 고아를 이용하여 봉신에 대한 몇 가지 음모를 꾸밀 수 있다.                     #
#==============================================================================#

#------------------------------------------------------------------------------#
# 생명의 은인 2 (7001~7016) / 트리거 이벤트                                    #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7001
	hide_window = yes

	ai = no

	trigger = {

		#----------------------------------------------------------------------#
		# 모드 셋업 여부 확인                                                  #
		#----------------------------------------------------------------------#

		has_global_flag = MOD_NEMO_OPG_SETUP_OK

		#----------------------------------------------------------------------#
		# Conclave DLC 필요                                                    #
		#----------------------------------------------------------------------#

		has_dlc = "Zeus"

		#----------------------------------------------------------------------#
		# 일반 상태의 성인 플레이어 확인                                       #
		#----------------------------------------------------------------------#

		is_common_adult_player_trigger = yes

		#----------------------------------------------------------------------#
		# 건물 : 고아원 레벨 4 이상의 고아원 건물이 필요                       #
		#----------------------------------------------------------------------#

		has_orphanage_level_4_trigger = yes

		#----------------------------------------------------------------------#
		# 현재 고아원에 7살~8살의 플레이어가 구출한 고아가 있을 것             #
		# - 전쟁 고아 플래그를 가지고 있어서는 안 된다.                        #
		# - 이미 Secret Agent 이벤트를 통해 충성을 맹세했거나,                 #
		# - 그러지 않기로 확정된 캐릭터가 아니어야 한다.                       #
		#----------------------------------------------------------------------#

		any_courtier = {
			trait = rescued_orphan_by_player
			is_adult = no
			age = 7
			NOT = { age = 9 }
			NOT = { has_character_flag = mod_event_character_flag_war_orphan }
			NOT = { has_character_flag = mod_event_character_flag_war_orphan_with_reminiscence }
			NOT = { has_character_flag = mod_event_character_flag_war_orphan_without_reminiscence }

			NOT = { has_character_flag = mod_event_character_flag_loyalty_1 }
			NOT = { has_character_flag = mod_event_character_flag_loyalty_2 }
			NOT = { has_character_flag = mod_event_character_flag_loyalty_3 }
			NOT = { has_character_flag = mod_event_character_flag_secret_agent }
			NOT = { has_character_flag = mod_event_character_flag_not_secret_agent }

			is_orphan_in_orphanage_trigger = yes
			is_liege_human_player_character_trigger = yes
			is_orphan_pending_special_event_trigger = no
		}

		#----------------------------------------------------------------------#
		# 현재 고아원의 노멀 고아 숫자가 최소 8명 이상 되어야 한다.            #
		#----------------------------------------------------------------------#

		any_courtier = {
			count = 8
			OR = {
				trait = rescued_orphan_by_ai
				trait = rescued_orphan_by_player
			}
			is_adult = no

			is_orphan_in_orphanage_trigger = yes
			is_liege_human_player_character_trigger = yes
			is_orphan_pending_special_event_trigger = no
		}

		#----------------------------------------------------------------------#
		# 현재 진행중~그런 고아가 1명도 존재하지 않아야 한다.                  #
		#----------------------------------------------------------------------#

		NOT = {
			any_realm_character = {
				trait = rescued_orphan_by_player
				is_adult = no
				OR = {
					has_character_flag = mod_event_character_flag_loyalty_1
					has_character_flag = mod_event_character_flag_loyalty_2
					has_character_flag = mod_event_character_flag_loyalty_3
					has_character_flag = mod_event_character_flag_secret_agent
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 270
	}

	immediate = {
		random_courtier = {
			limit = {
				trait = rescued_orphan_by_player
				is_adult = no
				age = 7
				NOT = { age = 9 }
				NOT = { has_character_flag = mod_event_character_flag_war_orphan }
				NOT = { has_character_flag = mod_event_character_flag_war_orphan_with_reminiscence }
				NOT = { has_character_flag = mod_event_character_flag_war_orphan_without_reminiscence }

				NOT = { has_character_flag = mod_event_character_flag_loyalty_1 }
				NOT = { has_character_flag = mod_event_character_flag_loyalty_2 }
				NOT = { has_character_flag = mod_event_character_flag_loyalty_3 }
				NOT = { has_character_flag = mod_event_character_flag_secret_agent }
				NOT = { has_character_flag = mod_event_character_flag_not_secret_agent }

				is_orphan_in_orphanage_trigger = yes
				is_liege_human_player_character_trigger = yes
				is_orphan_pending_special_event_trigger = no
			}

			character_event = {
				id = OPG.7002
			}
		}
	}
}

character_event = {
	id = OPG.7002
	hide_window = yes

	is_triggered_only = yes

	immediate = {

		#----------------------------------------------------------------------#
		# 모든 고아가 맹목적인 충성 이벤트를 갖게 되는 것은 아니다. 확률은 30% #
		# 로 잡는다.                                                           #
		#----------------------------------------------------------------------#

		random_list = {
			30 = {

				ROOT = {
					save_event_target_as = mod_event_target_orphan
				}
				FROM = {
					save_event_target_as = mod_event_target_player
				}

				set_character_flag = mod_event_character_flag_loyalty_1

				event_target:mod_event_target_player = {
					hidden_tooltip = {
						character_event = {
							id = OPG.7003
						}
					}	
				}
			}
			70 = {
				set_character_flag = mod_event_character_flag_not_secret_agent
			}
		}
	}
}

character_event = {
	id = OPG.7003
	desc = EVTDESC_OPG_7003
	picture = GFX_evt_nemo_lightening_night

	# mod_event_target_orphan (FROM)
	# mod_event_target_player (ROOT)

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7003
		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7007
				}
			}
		}	
	}

	option = {
		name = EVTOPTB_OPG_7003
		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7004
					days = 1
				}
			}
		}	
	}
}

character_event = {
	id = OPG.7004
	hide_window = yes

	is_triggered_only = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	immediate = {
		
		#----------------------------------------------------------------------#
		# 직접 구하러 나가지 않는다면 이 이벤트는 더 진행되지 않는다.          #
		#----------------------------------------------------------------------#

		set_character_flag = mod_event_character_flag_not_secret_agent
		clr_character_flag = mod_event_character_flag_loyalty_1

		random_list = {

			#------------------------------------------------------------------#
			# 50% 확률로 고아가 사망, 50% 의 확률로 구조                       #
			#------------------------------------------------------------------#

			50 = {
				event_target:mod_event_target_player = {
					character_event = {
						id = OPG.7005
					}
				}
			}
			50 = {
				event_target:mod_event_target_player = {
					character_event = {
						id = OPG.7006
					}
				}
			}
		}
	}
}

character_event = {

	id = OPG.7005
	desc = EVTDESC_OPG_7005
	picture = GFX_evt_nemo_dead		# Base Mod

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7005

		#----------------------------------------------------------------------#
		# 고아 사망 (이유: 사고)                                               #
		#----------------------------------------------------------------------#

		event_target:mod_event_target_orphan = {
			death = {
				death_reason = death_accident
			} 
		}

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}

character_event = {

	id = OPG.7006
	desc = EVTDESC_OPG_7006
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7006

		event_target:mod_event_target_orphan = {
			health = -0.5
		}

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}

character_event = {
	id = OPG.7007
	hide_window = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	is_triggered_only = yes

	immediate = {

		#----------------------------------------------------------------------#
		# 이벤트가 일어나는 기간이 좀 길기 때문에, 그 동안 이 고아에게 다른 이 #
		# 벤트가 일어나지 않도록 막는다.                                       #
		#----------------------------------------------------------------------#

		set_npc_is_pending_certain_event_flag_effect = yes
			
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7008
			}
		}
	}
}

character_event = {
	id = OPG.7008
	desc = EVTDESC_OPG_7008
	picture = GFX_evt_nemo_lightening_night

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7008
		hidden_tooltip = {
			character_event = {
				id = OPG.7009
			}
		}	
	}
}

character_event = {
	id = OPG.7009
	desc = EVTDESC_OPG_7009
	picture = GFX_evt_nemo_lightening_night

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7009
		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7010
				}
			}
		}	
	}
}

character_event = {
	id = OPG.7010
	hide_window = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	is_triggered_only = yes

	immediate = {
		
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7011
			}
		}
	}
}

character_event = {
	id = OPG.7011
	desc = EVTDESC_OPG_7011
	picture = GFX_evt_nemo_lightening_night

	# mod_event_target_orphan 
	# mod_event_target_player (ROOT)

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7011
		hidden_tooltip = {
			character_event = {
				id = OPG.7012
			}
		}	
	}
}

character_event = {
	id = OPG.7012
	desc = EVTDESC_OPG_7012
	picture = GFX_evt_nemo_lightening_night

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = EVTOPTA_OPG_7012

		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7013
				}
			}
		}	
	}
}

character_event = {
	id = OPG.7013
	hide_window = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	is_triggered_only = yes

	immediate = {
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7014
				days = 7
			}
		}
	}
}

character_event = {

	id = OPG.7014
	desc = EVTDESC_OPG_7014
	picture = GFX_evt_recieve_letter

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7014
		ROOT = {
			hidden_tooltip = {
				letter_event = {
					id = OPG.7015
				}
			}
		}
	}
}

letter_event = {

	id = OPG.7015
	desc = EVTDESC_OPG_7015
	
	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7015

		hidden_tooltip = {
			letter_event = {
				id = OPG.7016
			}
		}
	}
}

letter_event = {

	id = OPG.7016
	desc = EVTDESC_OPG_7016
	
	is_triggered_only = yes
	show_from_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7016

		prestige = 10
		piety = 5

		hidden_tooltip = {
			event_target:mod_event_target_orphan = {

				#--------------------------------------------------------------#
				# 만약 기존에 특별한 수련을 받고 있었다면 이를 해제한다.       #
				#--------------------------------------------------------------#

				remove_special_training_for_orphan_flag_effect = yes

				#--------------------------------------------------------------#
				# 이벤트 발생 중 플래그를 해제한다.                            #
				#--------------------------------------------------------------#

				clr_npc_is_pending_certain_event_flag_effect = yes

				#--------------------------------------------------------------#
				# 이벤트 특성상, 중간에 주군이 사망하거나 하면 이 이벤트는 초  #
				# 기화되어야 하므로 연결을 해 두어야 한다. (고아 -> 주군)      #
				#--------------------------------------------------------------#

				opinion = {
					who = ROOT
					modifier = opinion_mod_orphans_boss_of_intrigue
				}
			}
		}

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}


#------------------------------------------------------------------------------#
# 고아의 변화 (7021~7025) / 트리거 이벤트                                      #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7021
	hide_window = yes

	ai = no

	trigger = {

		#----------------------------------------------------------------------#
		# 모드 셋업 여부 확인                                                  #
		#----------------------------------------------------------------------#

		has_global_flag = MOD_NEMO_OPG_SETUP_OK

		#----------------------------------------------------------------------#
		# 일반 상태의 성인 플레이어 확인                                       #
		#----------------------------------------------------------------------#

		is_common_adult_player_trigger = yes

		#----------------------------------------------------------------------#
		# 건물 : 고아원 레벨 4 이상의 고아원 건물이 필요                       #
		#----------------------------------------------------------------------#

		has_orphanage_level_4_trigger = yes

		#----------------------------------------------------------------------#
		# 현재 고아원에 "생명의 은인 2" 이벤트가 발생한 캐릭터가 존재할 것     #
		# 해당 이벤트가 발생한 지 1년 이상 지난 시점이어야 한다.               #
		#----------------------------------------------------------------------#

		any_courtier = {
			trait = rescued_orphan_by_player
			is_adult = no

			has_character_flag = mod_event_character_flag_loyalty_1
			had_character_flag = { flag = mod_event_character_flag_loyalty_1 days = 365 }

			is_orphan_in_orphanage_trigger = yes
			is_liege_human_player_character_trigger = yes
			is_orphan_pending_special_event_trigger = no
		}

		#----------------------------------------------------------------------#
		# 현재 고아원 보모가 임무 없이 수도에 있어야 함                        #
		#----------------------------------------------------------------------#

		is_orphanage_nurse_in_capital_trigger = yes
	}

	mean_time_to_happen = {
		days = 26
	}

	immediate = {
		random_courtier = {
			limit = {
				trait = rescued_orphan_by_player
				is_adult = no

				has_character_flag = mod_event_character_flag_loyalty_1
				had_character_flag = { flag = mod_event_character_flag_loyalty_1 days = 365 }

				is_orphan_in_orphanage_trigger = yes
				is_liege_human_player_character_trigger = yes
				is_orphan_pending_special_event_trigger = no
			}

			character_event = {
				id = OPG.7022
			}
		}
	}
}

character_event = {
	id = OPG.7022
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		ROOT = {
			save_event_target_as = mod_event_target_orphan
		}
		FROM = {
			save_event_target_as = mod_event_target_player
		}

		set_character_flag = mod_event_character_flag_loyalty_2
		clr_character_flag = mod_event_character_flag_loyalty_1

		event_target:mod_event_target_player = {
			random_courtier = {
				limit = {
					is_orphanage_nurse_trigger = yes
				}
				save_event_target_as = mod_event_target_orphanage_nurse

				character_event = {
					id = OPG.7023
				}
			}
		}
	}
}

character_event = {
	id = OPG.7023
	hide_window = yes

	# mod_event_target_orphan
	# mod_event_target_player
	# mod_event_target_orphanage_nurse (ROOT)

	is_triggered_only = yes

	immediate = {
		
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7024
			}
		}
	}
}

character_event = {

	id = OPG.7024
	desc = EVTDESC_OPG_7024
	picture = GFX_evt_nemo_common_discuss

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)
	# mod_event_target_orphanage_nurse

	option = {
		name = EVTOPTA_OPG_7024

		hidden_tooltip = {
			ROOT = {
				character_event = {
					id = OPG.7025
				}
			}
		}
	}
}

character_event = {

	id = OPG.7025
	desc = EVTDESC_OPG_7025
	picture = GFX_evt_nemo_common_discuss

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)
	# mod_event_target_orphanage_nurse

	option = {
		name = EVTOPTA_OPG_7025

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphanage_nurse
		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}


#------------------------------------------------------------------------------#
# 베일에 싸인 자 (7031~7035) / 트리거 이벤트                                   #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7031
	hide_window = yes

	ai = no

	trigger = {

		#----------------------------------------------------------------------#
		# 모드 셋업 여부 확인                                                  #
		#----------------------------------------------------------------------#

		has_global_flag = MOD_NEMO_OPG_SETUP_OK

		#----------------------------------------------------------------------#
		# 일반 상태의 성인 플레이어 확인                                       #
		#----------------------------------------------------------------------#

		is_common_adult_player_trigger = yes

		#----------------------------------------------------------------------#
		# 건물 : 고아원 레벨 4 이상의 고아원 건물이 필요                       #
		#----------------------------------------------------------------------#

		has_orphanage_level_4_trigger = yes

		#----------------------------------------------------------------------#
		# "고아의 변화" 이벤트가 발생한 자가 고아원에 있을 것.                 #
		# 이벤트가 발생한 지 1년 이상 지나고, 또한 10세를 넘겼을 것            #
		#----------------------------------------------------------------------#

		any_courtier = {
			trait = rescued_orphan_by_player
			is_adult = no
			age = 10

			has_character_flag = mod_event_character_flag_loyalty_2
			had_character_flag = { flag = mod_event_character_flag_loyalty_2 days = 365 }

			is_orphan_in_orphanage_trigger = yes
			is_liege_human_player_character_trigger = yes
			is_orphan_pending_special_event_trigger = no
		}

		#----------------------------------------------------------------------#
		# 현재 첩보관이 임명되어 임무 수행 중 : Uncover Plot / Organize Spies  #
		#----------------------------------------------------------------------#

		job_spymaster = {
			OR = {
				has_job_action = action_uncover_plots
				has_job_action = action_organize_spies
			}
		}
	}

	mean_time_to_happen = {
		days = 13
	}

	immediate = {
		random_courtier = {
			limit = {
				trait = rescued_orphan_by_player
				is_adult = no
				age = 10

				has_character_flag = mod_event_character_flag_loyalty_2
				had_character_flag = { flag = mod_event_character_flag_loyalty_2 days = 365 }

				is_orphan_in_orphanage_trigger = yes
				is_liege_human_player_character_trigger = yes
				is_orphan_pending_special_event_trigger = no
			}

			character_event = {
				id = OPG.7032
			}
		}
	}
}

character_event = {
	id = OPG.7032
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		ROOT = {
			save_event_target_as = mod_event_target_orphan
		}
		FROM = {
			save_event_target_as = mod_event_target_player
		}

		set_character_flag = mod_event_character_flag_loyalty_3
		clr_character_flag = mod_event_character_flag_loyalty_2

		event_target:mod_event_target_player = {
			job_spymaster = {
				save_event_target_as = mod_event_target_spymaster
				character_event = {
					id = OPG.7033
				}
			}
		}
	}
}

character_event = {
	id = OPG.7033
	hide_window = yes

	# mod_event_target_orphan
	# mod_event_target_player
	# mod_event_target_spymaster (ROOT)

	is_triggered_only = yes

	immediate = {
		
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7034
			}
		}
	}
}

character_event = {

	id = OPG.7034
	desc = EVTDESC_OPG_7034
	picture = GFX_evt_recieve_letter

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)
	# mod_event_target_spymaster

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7034
		ROOT = {
			hidden_tooltip = {
				letter_event = {
					id = OPG.7035
				}
			}
		}
	}
}

letter_event = {

	id = OPG.7035
	desc = EVTDESC_OPG_7035
	
	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)
	# mod_event_target_spymaster

	option = {
		name = EVTOPTA_OPG_7035

		hidden_tooltip = {
			letter_event = {
				id = OPG.7036
			}
		}
	}
}

letter_event = {

	id = OPG.7036
	desc = EVTDESC_OPG_7036
	
	is_triggered_only = yes
	show_from_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)
	# mod_event_target_spymaster

	option = {
		name = EVTOPTA_OPG_7036

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_spymaster
		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}


#------------------------------------------------------------------------------#
# 편지 (7041~7045) / 트리거 이벤트                                             #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7041
	hide_window = yes

	ai = no

	trigger = {

		#----------------------------------------------------------------------#
		# 모드 셋업 여부 확인                                                  #
		#----------------------------------------------------------------------#

		has_global_flag = MOD_NEMO_OPG_SETUP_OK

		#----------------------------------------------------------------------#
		# 일반 상태의 성인 플레이어 확인                                       #
		#----------------------------------------------------------------------#

		is_common_adult_player_trigger = yes

		#----------------------------------------------------------------------#
		# 건물 : 고아원 레벨 4 이상의 고아원 건물이 필요                       #
		#----------------------------------------------------------------------#

		has_orphanage_level_4_trigger = yes

		#----------------------------------------------------------------------#
		# "베일에 싸인 자" 이벤트가 발생한 지 60일 이상 지났을 것              #
		# 이벤트가 진행중인 자가 12세를 넘겼을 것                              #
		#----------------------------------------------------------------------#

		any_courtier = {
			trait = rescued_orphan_by_player
			is_adult = no
			age = 12

			has_character_flag = mod_event_character_flag_loyalty_3
			had_character_flag = { flag = mod_event_character_flag_loyalty_3 days = 60 }

			is_orphan_in_orphanage_trigger = yes
			is_liege_human_player_character_trigger = yes
			is_orphan_pending_special_event_trigger = no
		}
	}

	mean_time_to_happen = {
		days = 13
	}

	immediate = {
		random_courtier = {
			limit = {
				trait = rescued_orphan_by_player
				is_adult = no
				age = 12

				has_character_flag = mod_event_character_flag_loyalty_3
				had_character_flag = { flag = mod_event_character_flag_loyalty_3 days = 60 }

				is_orphan_in_orphanage_trigger = yes
				is_liege_human_player_character_trigger = yes
				is_orphan_pending_special_event_trigger = no
			}

			character_event = {
				id = OPG.7042
			}
		}
	}
}

character_event = {
	id = OPG.7042
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		ROOT = {
			save_event_target_as = mod_event_target_orphan
		}
		FROM = {
			save_event_target_as = mod_event_target_player
		}

		set_character_flag = mod_event_character_flag_secret_agent
		clr_character_flag = mod_event_character_flag_loyalty_3

		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7044
			}
		}
	}
}

character_event = {

	id = OPG.7044
	desc = EVTDESC_OPG_7044
	picture = GFX_evt_recieve_letter

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7044
		ROOT = {
			hidden_tooltip = {
				letter_event = {
					id = OPG.7045
				}
			}
		}
	}
}

letter_event = {

	id = OPG.7045
	desc = EVTDESC_OPG_7045
	
	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7045

		hidden_tooltip = {
			letter_event = {
				id = OPG.7046
			}
		}
	}
}

letter_event = {

	id = OPG.7046
	desc = EVTDESC_OPG_7046
	
	is_triggered_only = yes
	show_from_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7046

		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7047
				}
			}
		}
	}
}

character_event = {
	id = OPG.7047
	hide_window = yes

	is_triggered_only = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	immediate = {
		event_target:mod_event_target_player = {
			letter_event = {
				id = OPG.7048
			}
		}
	}
}

letter_event = {

	id = OPG.7048
	desc = EVTDESC_OPG_7048
	
	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7048

		hidden_tooltip = {
			letter_event = {
				id = OPG.7049
			}
		}
	}
}

letter_event = {

	id = OPG.7049
	desc = EVTDESC_OPG_7049
	
	is_triggered_only = yes
	show_from_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7049

		event_target:mod_event_target_orphan = {
			character_event = {
				id = OPG.7050
			}
		}
	}
}

character_event = {
	id = OPG.7050
	hide_window = yes

	is_triggered_only = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	immediate = {
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7051
			}
		}
	}
}

character_event = {

	id = OPG.7051
	desc = EVTDESC_OPG_7051
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7051

		hidden_tooltip = {
			character_event = {
				id = OPG.7052
			}
		}
	}
}

character_event = {

	id = OPG.7052
	desc = EVTDESC_OPG_7052
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7052

		hidden_tooltip = {
			character_event = {
				id = OPG.7053
			}
		}
	}
}

character_event = {

	id = OPG.7053
	desc = EVTDESC_OPG_7053
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes
	show_from_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7053

		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7054
				}
			}
		}
	}

	option = {
		name = EVTOPTB_OPG_7053

		hidden_tooltip = {
			event_target:mod_event_target_orphan = {
				character_event = {
					id = OPG.7058
				}
			}
		}
	}
}

## 아이를 평범한 아이로 돌려놓아야 한다.

character_event = {
	id = OPG.7054
	hide_window = yes

	is_triggered_only = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	immediate = {

		clr_character_flag = mod_event_character_flag_secret_agent
		set_character_flag = mod_event_character_flag_not_secret_agent

		change_diplomacy = 1
		change_martial = 1
		change_stewardship = 1
		change_intrigue = 1
		change_learning = 1

		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7055
			}
		}
	}
}

character_event = {

	id = OPG.7055
	desc = EVTDESC_OPG_7055
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7055

		hidden_tooltip = {
			character_event = {
				id = OPG.7056
			}
		}
	}
}

character_event = {

	id = OPG.7056
	desc = EVTDESC_OPG_7056
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7056

		hidden_tooltip = {
			character_event = {
				id = OPG.7057
			}
		}
	}
}

character_event = {

	id = OPG.7057
	desc = EVTDESC_OPG_7057
	picture = GFX_evt_nemo_default_orphanage

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	is_triggered_only = yes
	show_from_from_from = yes

	option = {
		name = EVTOPTA_OPG_7057

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}

## 이 아이를 훌륭한 스파이로 이용할 수 있을 것 같다.

character_event = {
	id = OPG.7058
	hide_window = yes

	is_triggered_only = yes

	# mod_event_target_orphan (ROOT)
	# mod_event_target_player

	immediate = {
		event_target:mod_event_target_player = {
			character_event = {
				id = OPG.7059
			}
		}
	}
}

character_event = {

	id = OPG.7059
	desc = EVTDESC_OPG_7059
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7059

		hidden_tooltip = {
			character_event = {
				id = OPG.7060
			}
		}
	}
}

character_event = {

	id = OPG.7060
	desc = EVTDESC_OPG_7060
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes
	show_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7060

		hidden_tooltip = {
			character_event = {
				id = OPG.7061
			}
		}
	}
}

character_event = {

	id = OPG.7061
	desc = EVTDESC_OPG_7061
	picture = GFX_evt_nemo_default_orphanage

	is_triggered_only = yes
	show_from_from_from = yes

	# mod_event_target_orphan
	# mod_event_target_player (ROOT)

	option = {
		name = EVTOPTA_OPG_7061

		#----------------------------------------------------------------------#
		# 고아의 그동안의 수련(?)을 반영하여 스탯을 대폭 증가시킨다.           #
		#----------------------------------------------------------------------#

		event_target:mod_event_target_orphan = {
			change_diplomacy = 5
			change_martial = 10
			change_stewardship = 3
			change_intrigue = 9
			change_learning = 1
		}

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}


#------------------------------------------------------------------------------#
# 스파이가 된 고아의 성년 (OPG.2342 에서 이쪽으로 온다.)                       #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7071
	desc = EVTDESC_OPG_7071
	picture = GFX_evt_nemo_dead

	is_triggered_only = yes

	# mod_event_target_player (ROOT)
	# mod_event_target_orphan

	immediate = {
		event_target:mod_event_target_orphan = {
			death = {
				death_reason = death_suicide
			} 
		}
	}

	option = {
		name = EVTOPTA_OPG_7071
		hidden_tooltip = {
			character_event = {
				id = OPG.7072
			}		
		}
	}
}

character_event = {

	id = OPG.7072
	desc = EVTDESC_OPG_7072
	picture = GFX_evt_nemo_dead

	is_triggered_only = yes
	hide_from = yes

	# mod_event_target_player (ROOT)
	# mod_event_target_orphan

	option = {
		name = EVTOPTA_OPG_7072

		#----------------------------------------------------------------------#
		# 이벤트 종료                                                          #
		#----------------------------------------------------------------------#

		clear_event_target = mod_event_target_orphan
		clear_event_target = mod_event_target_player
	}
}

#------------------------------------------------------------------------------#
# 연결된 주군이 사망한 경우의 문제                                             #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7073
	hide_window = yes

	ai = no

	trigger = {

		#----------------------------------------------------------------------#
		# 모드 셋업 여부 확인                                                  #
		#----------------------------------------------------------------------#

		has_global_flag = MOD_NEMO_OPG_SETUP_OK

		#----------------------------------------------------------------------#
		# 일반 상태의 플레이어 확인                                            #
		#----------------------------------------------------------------------#

		is_common_player_trigger = yes

		#----------------------------------------------------------------------#
		# 건물 : 고아원 레벨 4 이상의 고아원 건물이 필요                       #
		#----------------------------------------------------------------------#

		has_orphanage_level_4_trigger = yes

		#----------------------------------------------------------------------#
		# 현재 일련의 이벤트를 진행중인 고아가 있을 것.                        #
		# 고아의 일련의 이벤트의 상대 주군이 현재의 플레이어가 아닐 것.        #
		# (즉, 처음 이벤트를 시작한 주군 플레이어가 사망했을 것)               #
		#----------------------------------------------------------------------#

		any_courtier = {
			trait = rescued_orphan_by_player
			is_adult = no

			OR = {
				has_character_flag = mod_event_character_flag_loyalty_1
				has_character_flag = mod_event_character_flag_loyalty_2
				has_character_flag = mod_event_character_flag_loyalty_3
				has_character_flag = mod_event_character_flag_secret_agent
			}

			has_any_opinion_modifier = opinion_mod_orphans_boss_of_intrigue
			NOT = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_mod_orphans_boss_of_intrigue
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {

		any_courtier = {
			limit = {
				trait = rescued_orphan_by_player
				is_adult = no

				OR = {
					has_character_flag = mod_event_character_flag_loyalty_1
					has_character_flag = mod_event_character_flag_loyalty_2
					has_character_flag = mod_event_character_flag_loyalty_3
					has_character_flag = mod_event_character_flag_secret_agent
				}

				has_any_opinion_modifier = opinion_mod_orphans_boss_of_intrigue
				NOT = {
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_mod_orphans_boss_of_intrigue
					}
				}
			}
			character_event = {
				id = OPG.7074
			}
		}
	}
}


character_event = {
	id = OPG.7074
	hide_window = yes

	is_triggered_only = yes

	immediate = {

		#----------------------------------------------------------------------#
		# 아직 최종 이벤트에 다다르지 않았다면 전체를 무효화한다.              #
		# 이 아이는 보통의 고아와 같게 된다.                                   #
		#----------------------------------------------------------------------#

		if = {
			limit = {
				NOT = { has_character_flag = mod_event_character_flag_secret_agent }
			}
			clr_character_flag = mod_event_character_flag_loyalty_1
			clr_character_flag = mod_event_character_flag_loyalty_2
			clr_character_flag = mod_event_character_flag_loyalty_3
			
			set_character_flag = mod_event_character_flag_not_secret_agent

			any_opinion_modifier_target = {
				limit = {
					reverse_has_opinion_modifier = {
						 who = PREV
						 modifier = opinion_mod_orphans_boss_of_intrigue
					}
				}
				reverse_remove_opinion = {
					who = PREV
					modifier = opinion_mod_orphans_boss_of_intrigue
				}
			}

			break = yes
		}

		#----------------------------------------------------------------------#
		# 최종 이벤트를 지난 미성년자라면 사망 처리한다.                       #
		#----------------------------------------------------------------------#

		clr_character_flag = mod_event_character_flag_loyalty_1
		clr_character_flag = mod_event_character_flag_loyalty_2
		clr_character_flag = mod_event_character_flag_loyalty_3

		clr_character_flag = mod_event_character_flag_secret_agent

		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					 who = PREV
					 modifier = opinion_mod_orphans_boss_of_intrigue
				}
			}
			reverse_remove_opinion = {
				who = PREV
				modifier = opinion_mod_orphans_boss_of_intrigue
			}
		}

		death = {
			death_reason = death_suicide
		} 
	}
}



#------------------------------------------------------------------------------#
# 스파이의 방 - 비밀 임무를 부여하거나 철회                                    #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7101
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = {
				id = OPG.7102
			}
		}
	}
}

character_event = {

	id = OPG.7102
	desc = {
		text = EVTDESC_OPG_7102_1
		trigger = {
			FROM = {
				NOT = { has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued }
			}
		}
	}
	desc = {
		text = EVTDESC_OPG_7102_2
		trigger = {
			FROM = {
				has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued
			}
		}
	}	
	picture = GFX_evt_nemo_default_orphanage_attic_room

	is_triggered_only = yes


	option = {
		## A. 암살 임무를 맡긴다 #################################################

		name = EVTOPTA_OPG_7102
		trigger = {
			FROM = {
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_murder }
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_discord }
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering }
				NOT = { has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued }
			}
		}

		FROM = {
			hidden_tooltip = {
				character_event = {
					id = OPG.7103
				}
			}
		}
	}

	option = {
		## B. 불화 임무를 맡긴다 #################################################

		name = EVTOPTB_OPG_7102
		trigger = {
			FROM = {
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_murder }
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_discord }
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering }
				NOT = { has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued }
			}
		}
		FROM = {
			hidden_tooltip = {
				character_event = {
					id = OPG.7105
				}
			}
		}
	}

	#	option = {
	#		## C. 정보수집 임무를 맡긴다 #################################################
	#
	#		name = EVTOPTC_OPG_7102
	#		trigger = {
	#			FROM = {
	#				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_murder }
	#				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_discord }
	#				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering }
	#				NOT = { has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued }
	#			}
	#		}
	#		FROM = {
	#			hidden_tooltip = {
	#				character_event = {
	#					id = OPG.7107
	#				}
	#			}
	#		}
	#	}

	option = {
		## D. 현재 주어진 임무를 철회한다. #################################################

		name = EVTOPTD_OPG_7102
		trigger = {
			FROM = {
				OR = {
					has_character_flag = mod_event_character_flag_implicated_in_intrigue_murder
					has_character_flag = mod_event_character_flag_implicated_in_intrigue_discord
					has_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering
				}
				NOT = { has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued }
			}
		}
		FROM = {
			hidden_tooltip = {
				character_event = {
					id = OPG.7109
				}
			}
		}
	}

	option = {
		## E. 밖으로 나가기 #################################################

		name = EVTOPTE_OPG_7102
		trigger = {
			FROM = {
				NOT = { has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued }
			}
		}
		ROOT = {
			hidden_tooltip = {
				character_event = {
					id = OPG.2141
				}
			}
		}
	}

	option = {
		## F. 이벤트 : 공작에 실패한 아이를 꾸짖고 벌을 준다. ##

		name = EVTOPTF_OPG_7102
		trigger = {
			FROM = {
				has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued
			}
		}
		FROM = {
			hidden_tooltip = {
				character_event = {
					id = OPG.7111
				}
			}
		}
	}

	option = {
		## G. 이벤트 : 더 이상 이 아이를 이런 일에 이용할 순 없다. ##

		name = EVTOPTG_OPG_7102
		trigger = {
			FROM = {
				has_character_flag = mod_event_character_flag_fail_to_murder_but_rescued
			}
		}
		FROM = {
			hidden_tooltip = {
				character_event = {
					id = OPG.7113
				}
			}
		}
	}
}

## A. 암살 임무

character_event = {

	id = OPG.7103
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = {
				id = OPG.7104
			}
		}
	}
}

character_event = {

	id = OPG.7104
	desc = EVTDESC_OPG_7104
	picture = GFX_evt_nemo_default_orphanage_attic_room

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7104
		FROM = {
			set_character_flag = mod_event_character_flag_implicated_in_intrigue_murder

			hidden_tooltip = {
				character_event = {
					id = OPG.7101
				}
			}
		}
	}
}

## B. 불화 임무

character_event = {

	id = OPG.7105
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = {
				id = OPG.7106
			}
		}
	}
}

character_event = {

	id = OPG.7106
	desc = EVTDESC_OPG_7106
	picture = GFX_evt_nemo_default_orphanage_attic_room

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7106
		FROM = {
			set_character_flag = mod_event_character_flag_implicated_in_intrigue_discord

			hidden_tooltip = {
				character_event = {
					id = OPG.7101
				}
			}
		}
	}
}

## C. 정보수집 임무

	#character_event = {
	#
	#	id = OPG.7107
	#	hide_window = yes
	#	
	#	is_triggered_only = yes
	#	
	#	immediate = {
	#		FROM = {
	#			character_event = {
	#				id = OPG.7108
	#			}
	#		}
	#	}
	#}
	#
	#character_event = {
	#
	#	id = OPG.7108
	#	desc = EVTDESC_OPG_7108
	#	picture = GFX_evt_nemo_default_orphanage_attic_room
	#
	#	is_triggered_only = yes
	#
	#	option = {
	#		name = EVTOPTA_OPG_7108
	#		FROM = {
	#			set_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering
	#
	#			hidden_tooltip = {
	#				character_event = {
	#					id = OPG.7101
	#				}
	#			}
	#		}
	#	}
	#}

## D. 임무 철회

character_event = {

	id = OPG.7109
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = {
				id = OPG.7110
			}
		}
	}
}

character_event = {

	id = OPG.7110
	desc = EVTDESC_OPG_7110
	picture = GFX_evt_nemo_default_orphanage_attic_room

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7110
		FROM = {
			clr_character_flag = mod_event_character_flag_implicated_in_intrigue_murder
			clr_character_flag = mod_event_character_flag_implicated_in_intrigue_discord
			clr_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering

			hidden_tooltip = {
				character_event = {
					id = OPG.7101
				}
			}
		}
	}
}

## F. 이벤트 - 벌을 준 후 계속 요원으로 활용한다.

character_event = {

	id = OPG.7111
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = {
				id = OPG.7112
			}
		}
	}
}

character_event = {

	id = OPG.7112
	desc = EVTDESC_OPG_7112
	picture = GFX_evt_nemo_default_orphanage_attic_room

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7112
		FROM = {
			clr_character_flag = mod_event_character_flag_fail_to_murder_but_rescued

			hidden_tooltip = {
				character_event = {
					id = OPG.7101
				}
			}
		}
	}
}

## G. 이벤트 - 더 이상 이 아이를 이용할 수 없다.

character_event = {

	id = OPG.7113
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = {
				id = OPG.7114
			}
		}
	}
}

character_event = {

	id = OPG.7114
	desc = EVTDESC_OPG_7114
	picture = GFX_evt_nemo_default_orphanage_attic_room

	is_triggered_only = yes

	option = {
		name = EVTOPTA_OPG_7114
		FROM = {

			clr_character_flag = mod_event_character_flag_fail_to_murder_but_rescued
			clr_character_flag = mod_event_character_flag_secret_agent
			set_character_flag = mod_event_character_flag_not_secret_agent
		}
		ROOT = {
			hidden_tooltip = {
				character_event = {
					id = OPG.2141
				}
			}
		}
	}
}





#------------------------------------------------------------------------------#
# 비밀 임무                                                                    #
#------------------------------------------------------------------------------#

character_event = {

	id = OPG.7121
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {

		#----------------------------------------------------------------------#
		# 신분이나 임무의 변경이 있는지를 먼저 확인한다. (임무중단사유확인)    #
		#----------------------------------------------------------------------#

		if = {
			limit = {
				OR = {
					is_alive = no
					is_adult = yes
					NOT = { has_character_flag = mod_event_character_flag_secret_agent }
					NOT = { has_character_flag = mod_event_character_flag_guardian_selected_orphan }
				}
			}
			break = yes
		}

		if = {
			limit = {
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_murder }
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_discord }
				NOT = { has_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering }
			}
			break = yes
		}

		if = {
			limit = {
				educator = {
					ROOT = {
						NOT = {
							has_opinion_modifier = {
								who = PREV
								modifier = opinion_mod_orphans_target_of_intrigue
							}
						}
					}
				}
			}
			break = yes
		}

		if = {
			limit = {
				is_orphan_in_orphanage_trigger = yes
			}
			break = yes
		}

		#----------------------------------------------------------------------#
		# 임무를 수행한다.                                                     #
		#----------------------------------------------------------------------#

		## 임무의 상대방을 타겟팅 : 사실 이럴 필요가 있나..? 그냥 educator..

		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					who = PREV
					modifier = opinion_mod_orphans_target_of_intrigue
				}
			}
			save_event_target_as = mod_event_target_intriguer
		}

		save_event_target_as = mod_event_target_orphan

		if = {
			limit = {
				has_character_flag = mod_event_character_flag_implicated_in_intrigue_murder
			}

			random_list = {
				50 = {
					#----------------------------------------------------------#
					# 실패 : 그러나 발각되지 않음.                             #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7131
						}
					}
				}
				10 = {
					#----------------------------------------------------------#
					# 실패 : 고아가 자살함                                     #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7132
						}
					}
				}
				20 = {
					#----------------------------------------------------------#
					# 성공 : 자살로 위장한 살해 성공                           #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7133
						}
					}
				}
				20 = {
					modifier = {
						factor = 0
						event_target:mod_event_target_intriguer = {
							is_landed = no
						}
					}
					#----------------------------------------------------------#
					# 실패 : 음모 발각 (고아가 처형됨)                         #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7134
						}
					}
				}
			}
		}

		if = {
			limit = {
				has_character_flag = mod_event_character_flag_implicated_in_intrigue_discord
			}

			random_list = {
				52 = {
					#----------------------------------------------------------#
					# 실패                                                     #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7141
						}
					}
				}
				12 = {
					modifier = {
						factor = 0
						current_heir = {
							ai = no
						}
					}
					#----------------------------------------------------------#
					# 성공 : 후계자와의 우호도가 감소                          #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7142
						}
					}
				}
				12 = {
					modifier = {
						factor = 0
						is_married = no
					}
					#----------------------------------------------------------#
					# 성공 : 배우자와의 우호도가 감소                          #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7143
						}
					}
				}
				12 = {
					#----------------------------------------------------------#
					# 성공 : 임의의 자문회원과의 우호도가 감소                 #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7144
						}
					}
				}
				12 = {
					#----------------------------------------------------------#
					# 성공 : 임의의 봉신과의 우호도가 감소                     #
					#----------------------------------------------------------#

					liege = {
						character_event = {
							id = OPG.7145
						}
					}
				}
			}
		}

		if = {
			limit = {
				has_character_flag = mod_event_character_flag_implicated_in_intrigue_gathering
			}

			## 현재 정보수집 부분은 미구현
		}

		#----------------------------------------------------------------------#
		# 60 일 후에 이 이벤트를 다시 실행한다                                 #
		#----------------------------------------------------------------------#

		#clear_event_target = mod_event_target_intriguer

		repeat_event = { id = OPG.7121 days = 61 }
	}
}



## 살해 관련

character_event = {

	id = OPG.7131
	desc = EVTDESC_OPG_7131
	picture = GFX_evt_nemo_intrigue_failed_1

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7131
	}
}

character_event = {

	id = OPG.7132
	desc = EVTDESC_OPG_7132
	picture = GFX_evt_nemo_dead

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7132
		FROM = {
			death = {
				death_reason = death_suicide
			} 
		}
	}
}

character_event = {

	id = OPG.7133
	desc = EVTDESC_OPG_7133
	picture = GFX_evt_nemo_dead		# Base Mod

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7132
		event_target:mod_event_target_intriguer = {
			death = {
				death_reason = death_suicide
			} 
		}
	}
}

character_event = {

	id = OPG.7134
	desc = EVTDESC_OPG_7134
	picture = GFX_evt_emissary		# Original

	is_triggered_only = yes
	hide_from = yes

	# mod_event_target_intriguer
	# mod_event_target_orphan

	immediate = {
		event_target:mod_event_target_orphan = {
			imprison = event_target:mod_event_target_intriguer
		}
		save_event_target_as = mod_event_target_player
	}

	option = {
		name = EVTOPTA_OPG_7134
		event_target:mod_event_target_orphan = {
			death = {
				death_reason = death_execution
				killer = event_target:mod_event_target_intriguer
			} 
		}
	}
	option = {
		name = EVTOPTB_OPG_7134
		event_target:mod_event_target_intriguer = {
			character_event = {
				id = OPG.7135
			}
		}
	}
	option = {
		name = EVTOPTC_OPG_7134
		event_target:mod_event_target_orphan = {
			death = {
				death_reason = death_execution
				killer = event_target:mod_event_target_intriguer
			} 
		}
		event_target:mod_event_target_intriguer = {
			war = {
				target = ROOT
				casus_belli = bid_for_independence
			}
		}
	}
}

character_event = {

	id = OPG.7135
	hide_window = yes
	
	is_triggered_only = yes

	immediate = {

		event_target:mod_event_target_orphan = {
			prisoner = no
			clear_abuse_flag_modifier_orphan_under_guardianship_effect = yes
			clear_flag_modifier_orphan_under_guardianship_effect = yes
			move_character = event_target:mod_event_target_player
			remove_guardian = yes

			random_list = {
				20 = {
				}
				40 = {
					add_trait = wounded
				}
				40 = {
					add_trait = maimed
				}
			}

			imprison = event_target:mod_event_target_player
		}

		FROM = {
			character_event = {
				id = OPG.7136
				days = 7
			}
		}
	}
}

character_event = {

	id = OPG.7136
	desc = EVTDESC_OPG_7136
	picture = GFX_evt_nemo_default_dungeon		# Base Mod

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7136
		trigger = {
			scaled_wealth = 4.0
		}
		custom_tooltip = {
			text = CUSTOM_TOOLTIP_ORPHAN_WILL_ESCAPE_FROM_PRISON
			hidden_tooltip = {
				event_target:mod_event_target_orphan = {
					prisoner = no
					remove_opinion = {
						who = event_target:mod_event_target_intriguer
						modifier = opinion_mod_orphans_target_of_intrigue
					}
					clr_character_flag = mod_event_character_flag_implicated_in_intrigue_murder
					set_character_flag = mod_event_character_flag_fail_to_murder_but_rescued
				}
			}
		}
		prestige = -100
		transfer_scaled_wealth = {
			to = event_target:mod_event_target_intriguer
			value = 4.0
		}
		event_target:mod_event_target_intriguer = {
			set_character_flag = mod_event_character_flag_npc_refuse_to_be_guardian_of_orphan
		}
	}
	option = {
		name = EVTOPTB_OPG_7136
		event_target:mod_event_target_orphan = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
	}
}

## 불화 관련

character_event = {

	id = OPG.7141
	desc = EVTDESC_OPG_7141
	picture = GFX_evt_nemo_intrigue_successed_1

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7141
	}
}

character_event = {

	id = OPG.7142
	desc = EVTDESC_OPG_7142
	picture = GFX_evt_nemo_intrigue_successed_1

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7142
		event_target:mod_event_target_intriguer = {
			current_heir = {
				opinion = {
					who = PREV
					modifier = opinion_mod_decrease_opinion_orphan_intrigue
				}
			}
		}
	}
}

character_event = {

	id = OPG.7143
	desc = EVTDESC_OPG_7143
	picture = GFX_evt_nemo_intrigue_successed_1

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7143
		event_target:mod_event_target_intriguer = {
			spouse = {
				opinion = {
					who = PREV
					modifier = opinion_mod_decrease_opinion_orphan_intrigue
				}
			}
		}
	}
}

character_event = {

	id = OPG.7144
	desc = EVTDESC_OPG_7144
	picture = GFX_evt_nemo_intrigue_successed_1

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7144
		event_target:mod_event_target_intriguer = {
			random = {
				chance = 35
				job_chancellor = {
					opinion = {
						who = PREV
						modifier = opinion_mod_decrease_opinion_orphan_intrigue
					}
				}
			}

			random = {
				chance = 35
				job_marshal = {
					opinion = {
						who = PREV
						modifier = opinion_mod_decrease_opinion_orphan_intrigue
					}
				}
			}

			random = {
				chance = 35
				job_treasurer = {
					opinion = {
						who = PREV
						modifier = opinion_mod_decrease_opinion_orphan_intrigue
					}
				}
			}

			random = {
				chance = 35
				job_spymaster = {
					opinion = {
						who = PREV
						modifier = opinion_mod_decrease_opinion_orphan_intrigue
					}
				}
			}
			random = {
				chance = 35
				job_spiritual = {
					opinion = {
						who = PREV
						modifier = opinion_mod_decrease_opinion_orphan_intrigue
					}
				}
			}
		}
	}
}

character_event = {

	id = OPG.7145
	desc = EVTDESC_OPG_7145
	picture = GFX_evt_nemo_intrigue_successed_1

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_OPG_7145
		event_target:mod_event_target_intriguer = {
			random_vassal = {
				opinion = {
					who = PREV
					modifier = opinion_mod_decrease_opinion_orphan_intrigue
				}
			}
		}
	}
}